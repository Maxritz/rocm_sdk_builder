From e73c09c0fe5da90e755257d86459262b4ce29a75 Mon Sep 17 00:00:00 2001
From: Mika Laitio <lamikr@gmail.com>
Date: Mon, 23 Dec 2024 16:39:09 -0800
Subject: [PATCH 8/8] add gcn5 architecture check to triton

Signed-off-by: Mika Laitio <lamikr@gmail.com>
---
 .../third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h  | 1 +
 .../third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp    | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/third_party/triton/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h b/third_party/triton/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
index a49e442..1da652f 100644
--- a/third_party/triton/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
+++ b/third_party/triton/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
@@ -8,6 +8,7 @@ namespace mlir::triton::AMD {
 // A list of ISA families we care about.
 enum class ISAFamily {
   Unknown,
+  GCN5,
   CDNA1,
   CDNA2,
   CDNA3,
diff --git a/third_party/triton/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp b/third_party/triton/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
index 63fb972..ced97fa 100644
--- a/third_party/triton/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
+++ b/third_party/triton/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
@@ -11,6 +11,10 @@ ISAFamily deduceISAFamily(llvm::StringRef arch) {
 
   // CDNA ISA cases
   switch (kind) {
+  case llvm::AMDGPU::GK_GFX900:
+  case llvm::AMDGPU::GK_GFX902:
+  case llvm::AMDGPU::GK_GFX906:
+    return ISAFamily::GCN5;
   case llvm::AMDGPU::GK_GFX942:
   case llvm::AMDGPU::GK_GFX941:
   case llvm::AMDGPU::GK_GFX940:
-- 
2.43.0

